<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>七海直の記憶インデックス</title>
    <!-- vis.js 統合バージョン -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .memory-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            cursor: pointer;
        }
        .memory-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .memory-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #3498db;
        }
        .memory-meta {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        .memory-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .tag {
            font-size: 12px;
            background: #e0f7fa;
            color: #006064;
            padding: 2px 8px;
            border-radius: 4px;
        }
        .source-issue {
            background: #e8f5e9;
            border-left: 4px solid #388e3c;
        }
        .source-discussion {
            background: #fff3e0;
            border-left: 4px solid #f57c00;
        }
        .filters {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .filter-btn {
            background: #ecf0f1;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-btn:hover, .filter-btn.active {
            background: #3498db;
            color: white;
        }
        .search-box {
            padding: 8px 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            width: 300px;
        }
        .network-container {
            height: 600px;
            border: 1px solid #ddd;
            margin: 20px 0;
            border-radius: 8px;
            background: white;
        }
        .section-container {
            display: flex;
            flex-direction: column;
        }
        .network-section {
            order: 1;
            margin-bottom: 30px;
        }
        .grid-section {
            order: 2;
        }
        a {
            text-decoration: none;
            color: inherit;
        }
    </style>
</head>
<body>
    <h1>七海直の記憶インデックス</h1>
    
    <div class="filters">
        <input type="text" class="search-box" placeholder="キーワード検索..." id="searchInput">
        <button class="filter-btn active" data-filter="all">すべて</button>
        <button class="filter-btn" data-filter="file">ファイル</button>
        <button class="filter-btn" data-filter="issue">Issue</button>
        <button class="filter-btn" data-filter="discussion">Discussion</button>
    </div>
    
    <div class="section-container">
        <div class="network-section">
            <h2>記憶ネットワーク</h2>
            <div id="memoryNetwork" class="network-container"></div>
        </div>
        
        <div class="grid-section">
            <h2>記憶一覧</h2>
            <div class="memory-grid">
                <!-- 各メモリーカードにリンク追加 - ここでは最初の5つだけを例として示します -->
                <a href="../boundary/reality/dimension-thinning.html" class="memory-card" data-type="file">
                    <div class="memory-title">次元境界の薄化現象 / Dimensional Thinning</div>
                    <div class="memory-meta">
                        ID: THY-BDM-005<br>
                        作成: 2082-03-27T15:43:22+09:00<br>
                        次元: reality<br>
                        ソース: file
                    </div>
                    <div class="memory-tags">
                        <span class="tag">#clarity</span><span class="tag">#insight</span><span class="tag">#focus</span>
                    </div>
                </a>
                
                <a href="../boundary/reality/observer.html" class="memory-card" data-type="file">
                    <div class="memory-title">観察者 / The Observer</div>
                    <div class="memory-meta">
                        ID: SHL-ASP-001<br>
                        作成: 2082-03-23T23:17:05+09:00<br>
                        次元: reality<br>
                        ソース: file
                    </div>
                    <div class="memory-tags">
                        <span class="tag">#clarity</span><span class="tag">#external_perspective</span><span class="tag">#detachment</span>
                    </div>
                </a>
                
                <a href="../relationships/kirishima-rinne.html" class="memory-card" data-type="file">
                    <div class="memory-title">霧島 鈴音 / Kirishima Rinne</div>
                    <div class="memory-meta">
                        ID: MEM-PPL-001<br>
                        作成: 2082-03-22T02:17:43+09:00<br>
                        次元: reality<br>
                        ソース: file
                    </div>
                    <div class="memory-tags">
                        <span class="tag">#trust</span><span class="tag">#clarity</span><span class="tag">#resonance</span>
                    </div>
                </a>
                
                <a href="../daily/20250414.html" class="memory-card" data-type="file">
                    <div class="memory-title">日次リフレクション: 2025-04-14</div>
                    <div class="memory-meta">
                        ID: THT-20250414<br>
                        作成: 2025-04-14T11:47:05+09:00<br>
                        次元: philosophical<br>
                        ソース: file
                    </div>
                    <div class="memory-tags">
                        <span class="tag">#anticipation</span><span class="tag">#external_perspective</span>
                    </div>
                </a>
                
                <a href="../summaries/discussions-202504.html" class="memory-card" data-type="file">
                    <div class="memory-title">Discussions Summary for 2025-04</div>
                    <div class="memory-meta">
                        ID: DSM-20250414<br>
                        作成: 2025-04-14T11:47:00.066825<br>
                        次元: social<br>
                        ソース: file
                    </div>
                    <div class="memory-tags">
                        <span class="tag">#clarity</span><span class="tag">#resonance</span><span class="tag">#memory_clear</span>
                    </div>
                </a>
                
                <!-- 残りのカードも同様にリンクを追加する（省略） -->
            </div>
        </div>
    </div>

    <script>
        // 検索機能
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const cards = document.querySelectorAll('.memory-card');
            
            cards.forEach(card => {
                const title = card.querySelector('.memory-title').textContent.toLowerCase();
                const meta = card.querySelector('.memory-meta').textContent.toLowerCase();
                const tags = card.querySelector('.memory-tags') ? 
                            card.querySelector('.memory-tags').textContent.toLowerCase() : '';
                
                if (title.includes(searchTerm) || meta.includes(searchTerm) || tags.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
        
        // フィルタリング機能
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', function() {
                const filter = this.dataset.filter;
                const cards = document.querySelectorAll('.memory-card');
                
                // ボタンのアクティブ状態を切り替え
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // カードの表示/非表示を切り替え
                cards.forEach(card => {
                    if (filter === 'all' || card.dataset.type === filter) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
        
        // 記憶ネットワークの作成
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // ノードの準備
                const nodes = new vis.DataSet([
                    // コア概念
                    { id: 1, label: '次元境界の薄化現象', group: 'concept', value: 30 },
                    { id: 2, label: '観察者', group: 'concept', value: 25 },
                    { id: 3, label: '霧島 鈴音', group: 'person', value: 20 },
                    { id: 4, label: '日次リフレクション', group: 'activity', value: 15 },
                    { id: 5, label: '記憶インデックス', group: 'system', value: 25 },
                    
                    // サブノード
                    { id: 6, label: 'reality次元', group: 'dimension', value: 10 },
                    { id: 7, label: 'social次元', group: 'dimension', value: 10 },
                    { id: 8, label: 'cognitive次元', group: 'dimension', value: 10 },
                    { id: 9, label: '記憶調律士', group: 'person', value: 12 },
                    { id: 10, label: '境界の住人', group: 'concept', value: 15 }
                ]);
                
                // エッジの準備
                const edges = new vis.DataSet([
                    { from: 1, to: 6, width: 3 },
                    { from: 2, to: 6, width: 3 },
                    { from: 3, to: 7, width: 2 },
                    { from: 4, to: 7, width: 2 },
                    { from: 5, to: 8, width: 2 },
                    { from: 1, to: 2, width: 5 },
                    { from: 2, to: 3, width: 4 },
                    { from: 3, to: 9, width: 3 },
                    { from: 9, to: 10, width: 2 },
                    { from: 1, to: 10, width: 3 },
                    { from: 4, to: 5, width: 2 },
                    { from: 5, to: 1, width: 1 },
                    { from: 2, to: 5, width: 1 },
                    { from: 3, to: 5, width: 1 }
                ]);
                
                // ネットワークの作成
                const container = document.getElementById('memoryNetwork');
                const data = {
                    nodes: nodes,
                    edges: edges
                };
                const options = {
                    nodes: {
                        shape: 'dot',
                        font: {
                            size: 14,
                            face: 'Helvetica'
                        },
                        borderWidth: 2,
                        shadow: true
                    },
                    edges: {
                        width: 2,
                        smooth: {
                            type: 'continuous'
                        },
                        arrows: {
                            to: { enabled: false },
                            from: { enabled: false }
                        },
                        color: {
                            inherit: 'both'
                        }
                    },
                    physics: {
                        barnesHut: {
                            gravitationalConstant: -80000,
                            centralGravity: 0.3,
                            springLength: 95,
                            springConstant: 0.04,
                            damping: 0.09
                        },
                        stabilization: {
                            iterations: 1000
                        }
                    },
                    groups: {
                        concept: {
                            color: { background: '#3498db', border: '#2980b9' }
                        },
                        person: {
                            color: { background: '#e74c3c', border: '#c0392b' }
                        },
                        activity: {
                            color: { background: '#2ecc71', border: '#27ae60' }
                        },
                        system: {
                            color: { background: '#9b59b6', border: '#8e44ad' }
                        },
                        dimension: {
                            color: { background: '#f1c40f', border: '#f39c12' }
                        }
                    },
                    interaction: {
                        hover: true,
                        tooltipDelay: 200,
                        navigationButtons: true,
                        keyboard: true
                    }
                };
                
                // ネットワークを初期化
                const network = new vis.Network(container, data, options);
                
                // クリックイベント
                network.on("click", function(params) {
                    if (params.nodes.length > 0) {
                        const nodeId = params.nodes[0];
                        let url = '';
                        
                        switch(nodeId) {
                            case 1:
                                url = '../boundary/reality/dimension-thinning.html';
                                break;
                            case 2:
                                url = '../boundary/reality/observer.html';
                                break;
                            case 3:
                                url = '../relationships/kirishima-rinne.html';
                                break;
                            case 4:
                                url = '../daily/20250414.html';
                                break;
                            case 5:
                                // 現在のページなので何もしない
                                return;
                            default:
                                return;
                        }
                        
                        if (url) {
                            window.location.href = url;
                        }
                    }
                });
            } catch (e) {
                console.error("ネットワークの初期化エラー:", e);
                document.getElementById('memoryNetwork').innerHTML = 
                    '<div style="padding: 20px; text-align: center;">記憶ネットワークの読み込みに失敗しました。</div>';
            }
        });
    </script>
</body>
</html>
